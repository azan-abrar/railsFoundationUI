
var app = angular.module("confizHRM", ['ngSanitize', 'ngCookies']);

app.config(function($routeProvider) {

  // LoginController Routes

  $routeProvider.when('/login', {
    templateUrl: '<%= asset_path("login.html") %>',
    controller: 'LoginController'
  });

  // EmployeesController Routes

  $routeProvider.when('/employees', {
    templateUrl: '<%= asset_path("employees.html") %>',
    controller: 'EmployeesController',
  });

  $routeProvider.when('/employee/new', {
   templateUrl: '<%= asset_path("employees/edit.html") %>',
 });

  $routeProvider.when('/employee/:employeeID', {
    templateUrl: '<%= asset_path("employees/show.html") %>',
    controller: 'EmployeesController'
  });

  $routeProvider.when('/employee/:employeeID/edit', {
    templateUrl: '<%= asset_path("employees/edit.html") %>',
    controller: 'EmployeesController'
  });
  
  // DepartmentsController Routes

  $routeProvider.when('/departments', {
    templateUrl: '<%= asset_path("departments.html") %>',
    controller: 'DepartmentsController',
    
  });

  $routeProvider.when('/department/new', {
    templateUrl: '<%= asset_path("departments/edit.html") %>',
  });

  $routeProvider.when('/department/:departmentID', {
    templateUrl: '<%= asset_path("departments/show.html") %>',
    controller: 'DepartmentsController'
  });

  $routeProvider.when('/department/:departmentID/edit', {
    templateUrl: '<%= asset_path("departments/edit.html") %>',
    controller: 'DepartmentsController'
  });

  // Redirect to index page of employees in case of route does no match

  $routeProvider.otherwise({redirectTo: '/employees'});

});

app.run(function($rootScope, $location, AuthenticationService, FlashService, Navigation) {
  var routesThatRequireAuth = ['/employees'];
  var routesIfLogin = ['/login'];

  $rootScope.$on('$routeChangeStart', function(event, next, current) {
    if (_(routesThatRequireAuth).contains($location.path()) && !AuthenticationService.isLoggedIn()) {
      $location.path('/login');
      FlashService.show("Please log in to continue.");
    } else if (_(routesIfLogin).contains($location.path()) && AuthenticationService.isLoggedIn()) {
      $location.path('/employees');
    }

    if (_(routesIfLogin).contains($location.path())) {
      Navigation.hideNav();
    } else {
      Navigation.showNav();
    }

  });

});

